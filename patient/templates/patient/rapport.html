<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Rapport Périodique</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
<div class="container">
  <h1>Rapport Périodique Vaccination & Nutrition</h1>

  <form method="get" class="row g-3 mb-4">
    <div class="col-md-3">
      <label for="date_debut" class="form-label">Date début</label>
      <input type="date" id="date_debut" name="date_debut" value="{{ date_debut|date:'Y-m-d' }}" class="form-control" required>
    </div>
    <div class="col-md-3">
      <label for="date_fin" class="form-label">Date fin</label>
      <input type="date" id="date_fin" name="date_fin" value="{{ date_fin|date:'Y-m-d' }}" class="form-control" required>
    </div>
    <div class="col-md-3 align-self-end">
      <button type="submit" class="btn btn-primary">Afficher le rapport</button>
    </div>
  </form>

  {% if peses %}
  <div class="mb-3">
    <a class="btn btn-outline-success" href="?date_debut={{ date_debut|date:'Y-m-d' }}&date_fin={{ date_fin|date:'Y-m-d' }}&format=docx">Télécharger DOCX</a>
    <a class="btn btn-outline-danger" href="?date_debut={{ date_debut|date:'Y-m-d' }}&date_fin={{ date_fin|date:'Y-m-d' }}&format=pdf">Télécharger PDF</a>
    <a class="btn btn-outline-secondary" href="?date_debut={{ date_debut|date:'Y-m-d' }}&date_fin={{ date_fin|date:'Y-m-d' }}&format=html_download">Télécharger HTML</a>
  </div>

  <h3>Séances de pesée ({{ date_debut }} → {{ date_fin }})</h3>
  <table class="table table-bordered table-sm">
    <thead><tr><th>Tranche</th><th>Masculin</th><th>Féminin</th><th>Total</th></tr></thead>
    <tbody>
      {% for g, c in peses.items %}
        <tr><td>{{ g }}</td><td>{{ c.M }}</td><td>{{ c.F }}</td><td>{{ c.TOTAL }}</td></tr>
      {% endfor %}
    </tbody>
    <tfoot><tr><th colspan="3">Total</th><th>{{ total_peses }}</th></tr></tfoot>
  </table>

  <h3>Vaccinations</h3>
  <table class="table table-sm table-striped">
    <thead><tr><th>Antigène</th><th>Nombre</th></tr></thead>
    <tbody>
      {% for ag, n in antigen_counts.items %}
        <tr><td>{{ ag }}</td><td>{{ n }}</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <h3>Produits distribués</h3>
  <table class="table table-sm table-striped">
    <thead><tr><th>Produit</th><th>Quantité</th></tr></thead>
    <tbody>
      {% for p, n in produit_counts.items %}
        <tr><td>{{ p }}</td><td>{{ n }}</td></tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p class="alert alert-info">Aucune donnée disponible pour cette période.</p>
  {% endif %}
</div>
</body>
</html>
