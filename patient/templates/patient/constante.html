<!DOCTYPE html>
<html lang="fr">
  {% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prise de Constante</title>
    <link rel="stylesheet" href="{% static 'patient/style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  </head>
<body class="constante_body">
    {% csrf_token %}

    <div class="header-bar">
        <h1>Prise de constante</h1>
    </div>

    <div class="main-container">
        <div class="patient-info-box">
            <div class="patient-details">
                <i class="fas fa-user-circle profile-icon"></i>
                <span class="patient-name">{{patient.nom}} {{patient.prenom}}</span>
                <span class="patient-age">{{patient.age}} Mois</span>
                <span class="patient-sex">{{patient.sexe}}</span>
            </div>
        </div>

        <div class="content-area">
            <form class="constants-form" method="post" action="{% url 'enregistrement_constante' patient.id %}">
                {% csrf_token %}
                <div class="form-grid">
                    <label for="date">Date</label>
                    <input type="date" id="date" name="date" value="{{ today|date:'Y-m-d' }}">

                    <label for="taille">Taille</label>
                    <input type="text" id="taille" name="taille" inputmode="numeric" maxlength="3" pattern="[0-9]*">

                    <label for="poids">Poids</label>
                    <input type="text" id="poids" name="poids" inputmode="numeric" maxlength="3" pattern="[0-9]*">

                    <label for="pb">P. B.</label>
                    <input type="text" id="pb" name="pb" inputmode="numeric" maxlength="3" pattern="[0-9]*">

                    <label for="imc">IMC</label>
                    <input type="text" id="imc" name="imc" inputmode="numeric" maxlength="3" pattern="[0-9]*">

                    <label for="zscore">Z-score</label>
                    <input type="text" id="zscore" name="zscore" inputmode="numeric" maxlength="3" pattern="[0-9]*">

                    <label for="indicec">Indice C</label>
                    <input type="text" id="indicec" name="indicec">
                </div>

                <div class="button-group">
                    <a href="{% url 'rdv'%}"><button type="submit" class="btn btn-vaccin" id="btnVaccin">Enregistrer</button></a>
                    <!--<button type="submit" class="btn btn-nutrition" id="btnNutrition">Nutrition</button>-->
                </div>
            </form>

            <!--<div class="note-info">
                NB: Si le patient a un état normal, alors le bouton nutrition est grisé.
            </div>-->
            
        </div>
    </div>


<!-- gestion des bouton par javascript-->
<script> 
  document.addEventListener('DOMContentLoaded', () => {
    // 1. Récupération des éléments du DOM
    const imcField = document.getElementById('imc');
    const zscoreField = document.getElementById('zscore'); // Ajout du Z-score pour une vérification plus complète

    const btnVaccin = document.getElementById('btnVaccin');
    const btnNutrition = document.getElementById('btnNutrition');
    const indicec= document.getElementById('indicec');
    indicec.value="";

    // 2. Fonction de vérification de l'état du patient
    function checkPatientStatusAndToggleButtons() {
        const imcValue = parseFloat(imcField.value);
        const zscoreValue = parseFloat(zscoreField.value);
        // **********************************************
        // LOGIQUE DES BOTOUNS
        // **********************************************

        // ******************* definir état nutritionnel par zscore***************************
        switch (true) {
            case (zscoreValue < -3):
                indicec.value = "MAS";
                btnNutrition.classList.remove('disabled');
                break;
            case (zscoreValue >= -3 && zscoreValue < -2):
                indicec.value = "MAM";
                btnNutrition.classList.remove('disabled');
                break;
            case (zscoreValue >= -2 && zscoreValue <= 1):
                indicec.value = "Normal";
                btnNutrition.classList.add('disabled');
                break;
            case (zscoreValue > 1 && zscoreValue <= 2):
                indicec.value = "Surpoids";
                btnNutrition.classList.remove('disabled');
                break;
            case (zscoreValue > 2):
                indicec.value = "Obésité";
                btnNutrition.classList.remove('disabled');
                break;
            default:
                indicec.value = "";
        }
        
        
        // Si les champs sont vides, on grise le bouton nutrition
        //if (isNaN(zscoreValue) || zscoreField.value.trim() === "") {
        //     btnVaccin.classList.add('disabled');
        //     btnNutrition.classList.add('disabled');
             
        //}
    }

    // 3. Ajout des écouteurs d'événements
    // Le script s'exécute à chaque fois qu'une valeur change dans les champs importants
    imcField.addEventListener('input', checkPatientStatusAndToggleButtons);
    zscoreField.addEventListener('input', checkPatientStatusAndToggleButtons);

    // 4. Appel initial de la fonction au chargement de la page
    checkPatientStatusAndToggleButtons();
});
</script>
</body>
</html>